- **TEP**: [2](https://github.com/ton-blockchain/TEPs/pull/2)
- **title**: TON адреса
- **статус**: Активна
- **type**: Ядро
- **авторы**: -
- **создан**: 07.09.2019
- **Заменяет**: -
- \*\*заменено \*\*: -

# Summary

Этот документ описывает адреса TON и их представления.

# Спецификация

## Адреса Smart-контракта

Адрес Smart-contract в сети TON состоит из двух частей:

а) идентификатор рабочей цепи (знаковое 32-разрядное целое) и

b) адрес внутри рабочей цепочки (64-512 бит в зависимости от производственной цепочки).

В настоящее время в сети TON Blockchain работают только шедевры (workchain_id=-1) и базовая рабочая цепочка (workchain_id=0). Оба из них имеют 256-битные адреса, , так как пока не появятся новые рабочие сети, мы предполагаем, что workchain_id либо 0 или -1 и что адрес внутри рабочей цепочки равен примерно 256-биту.

В соответствии с вышеизложенными условиями адрес смарт-контракта может быть представлен в следующих формах:

A) "Raw": <decimal workchain_id>:<64 шестнадцатеричные цифры с адресом>

B) "Удобный в использовании", полученный первым поколением:

- один тег байт (0x11 для "отскочиваемых" адресов, 0x51 для "без отскочивания"; добавьте +0x80, если этот адрес не должен быть принят программным обеспечением, работающим в основной сети)
- один байт, содержащий 8-битное целое с знаком рабочей цепочки (0x00 для базовой цепочки, 0xff для masterchain)
- 32 байта, содержащие 256 бит адреса смарт-контракта внутри цепочки (big-endian)
- 2 байта, содержащие CRC16-CCITT предыдущих 34 байт

В случае В), полученная таким образом 36 байт затем кодируется с помощью base64 (т.е. с цифрами, заглавными и строчными латинскими буквами, '/' и '+') или base64url (с '_' и '-' вместо '/' и '+'), выдавая 48 печатных не пробельных символов.

Например:

Адрес "root dns" (специальный смарт-контракт, проживающий в мастер-цепочке)

`-1:e56754f83426f69b09267bd876ac97c44821345b7e266bd956a7bfbfb98df35c`

в форме "raw" (обратите внимание, что заглавные буквы 'A'..'F' могут быть использованы вместо 'a'..'f')

и

`Ef_lZ1T4NCb2mwkme9h2rJfESCE0W34ma9lWp7-_uY3zXDvq` (она)

`Uf_lZ1T4NCb2mwkme9h2rJfESCE0W34ma9lWp7-_uY3zXGYv` (non-bounceable)

в форме "удобной для пользователя" (отображается удобными для пользователя клиентами).

Обратите внимание, что обе формы (base64 и base64url) действительны и должны быть приняты.

## Кошельки приложения

В настоящее время кошельки TON работают со следующими адресами:

За получение:

- Адрес пользователя отображается в удобной или необременительной форме (в данный момент большинство бумажных приложений отображают грандиозную форму).

При отправке:

1. Приложение кошелька проверяет правильность представления адреса назначения - его длина, допустимые символы, префикс и контрольная сумма. Если адрес недействителен, то отображается предупреждение и операция отправки не выполняется.

2. Если адрес имеет флаг testnet, и приложение кошелька работает с сетью mainnet, , то отображается уведомление и операция отправки не выполняется.

3. Приложение кошелька получает из флага адресного возврата.

4. Приложение кошелька проверяет адрес назначения - есть ли флаг `unitialized` для отправки сообщения в `bounce` и игнорирует bounce/non-bounceable из формы адреса.

5. Если назначение не `unitialized`, то приложение для кошелька использует флаг bounceable/non-bounceable из представления адреса для поля `bounce` для отправки сообщения.

## Открытые ключи

ubiquitous 256-битные Ed25519 открытые ключи могут быть представлены в следующих формах:

A) "Raw": <64 шестнадцатеричные цифры с адресом>

B) "Удобный в пользовании" или "бронированный", получаемый первым поколением:

- один тег байт 0x3E, что означает, что это открытый ключ
- один тег байт 0xE6, что означает, что это публичный ключ Ed25519
- 32 байта, содержащие стандартное бинарное представление публичного ключа Ed25519
- 2 байта, содержащие big-endian представление CRC16-CCITT предыдущих 34 байта.

Результат 36-байтовой последовательности преобразуется в строку base64 или base64url стандартной формы.

Например, публичный ключ Ed25519 `E39ECDA0A7B0C60A7107EC43967829DBE8BC356A49B9DFC6186B3EAC74B5477D` (обычно представлен последовательностью 32 байт `0xE3, 0x9E, ..., 0x7D`) имеет следующее представление "бронированное":

`Pubjns2gp7DGCnEH7EOWeCnb6Lw1akm538YYaz6sdLVHfRB2`

## ADNL адрес

ADNL протокол на основе 256-битных абстрактных адресов.

Адрес ВОПОГ может быть представлен в следующих формах:

A) "Raw": <64 шестнадцатеричные цифры с адресом>

B) "Удобный в пользовании" или "бронированный", получаемый первым поколением:

- один тег байт 0x2d, что означает, что это ADNL адрес
- 32 байта, содержащие 256 бит ADNL адреса (big-endian)
- 2 байта, содержащие big-endian представление CRC16-CCITT предыдущих 34 байта.

В результате 35-байтовая последовательность преобразовывается в строку base32 в стандартной форме.

Например:

Например, адрес ADNL `45061C1D4EC44A937D0318589E13C73D151D1CEF5D3C0E53AFBCF56A6C2FE2BD` имеет следующее «бронированное» представительство:

`vcqmha5j3ceve35ammfrhqty46rkhi455otydstv66pk2tmf7rl25f3`

# Ничья

- Невозможно извлечь публичный ключ из адреса, , который необходим для некоторых задач (например, для отправки зашифрованного сообщения на этот адрес).
  Таким образом, до тех пор, пока не будет размещен смарт-контракт на этот адрес, невозможно получить открытый ключ в цепочке.

- (UI) Большинство ОС не позволяют вам выбрать адрес с двойным кликом из-за '_', '-', '/', '+' base64 символов.

# Обоснование и альтернативы

- Префикс (первый байт(ы)) позволяет точно понимать, какой именно тип этого адреса или ключа.

- Контрольная сумма, встроенная в адрес, предотвращает потерю средств из-за опечатки пользователя.

- Встроенный флаг testnet предотвращает потерю средств пользователем, который ошибочно пытается отправить реальные монеты на адрес testnet.

- Другой вид адреса, чем большинство других блокчейнов, позволяет пользователю более легко идентифицировать TON адрес.
